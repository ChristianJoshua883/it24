// This is the lightweight way to server render a dynamic HTML without any frameworks or libraries...
// Because it's time you out grow HTML/CSS and get over ES6 as a buzzword...
// All we need is the built in HTTP method, template strings and few functions and you can create powerful layouts...
// Start thinking in terms of vanilla JS but also in ways that transfer to react...
// Learn more in my book
// https://github.com/HansUXdev/JavaScript-First

const http = require('http')
const fs = require('fs');

// For Pages on your site
const homepages = [
    { 
      name: 'Home', 
      url: "/",
      icon: ""
    },
    { 
      name: 'About', 
      url: "/about",
      icon: "fa-user"
    },
    { 
      name: 'Portfolio', 
      url: "/Portfolio",
      icon: "fa-th"
    },
    { 
      name: 'Contact',
      url: "/Contact",
      icon: "fa-envelope"
    }
];
  

// layout template
const HTML = (header,body) => {
    return `<!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      ${header}
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css" integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script>
    </head>
    <body>
    ${body}
    </body>
    </html>`;
}

// used to create links to each page
// Example of how to use it
// let links = NavLinks(homepages)
const NavLinks = (data) => {
    return data.map(links => `
      <li class="nav-item">
        <a class="nav-link" href="${links.url}">${links.name}</a>
      </li>
    `).join('');
};

// Navbar Function to build a dynamic navbar on the server
/*
* Example
* create links for each page
* let links = NavLinks(homepages)
* pass that into the 'content' arguement and returns your final menu
* Nav(links)                     
*/

const Nav = (content, logo="https://hansmcmurdy.com/JavaScript-First/logo.svg") => {
  return `
  <div class="collapse" id="JSFirst">
    <div class="bg-dark p-4">
      <h5 class="text-white h4"> #JavaScriptFirst is an online Book </h5>
      <span class="text-muted">
      Learn more about the book here: <a class="" href="https://hansmcmurdy.com/JavaScript-First/">#JavaScriptFirst</a>
      </span>
    </div>
  </div>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="#" type="button" data-toggle="collapse" data-target="#JSFirst" aria-controls="JSFirst" aria-expanded="false" aria-label="Toggle navigation">
      <img src="${logo}" width="30" height="30" alt="image of a logo" loading="lazy">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
      <div class="navbar-nav">
        ${content}
      </div>
    </div>
  </div>
</nav>`;
};

/**
 * @export
 * @param {string} [route="/"]
 * @param {number} [port=8000]
 * @param {*} HTML - is a callback that returns an html string
 */
const Server = (home = "/", port=8000, template, pages=false )  =>{
    http.createServer(
        (request, response)=>{
        req = this.request;
        if(request.url == home){
          response.writeHead(200,{
            'Content-Type': 'text/html',
            'Content-Length': template.length,
            'Expires': new Date().toUTCString()
          })
          response.end(template)
        }
        else{
          // writeHTML()
          response.end("nope")
        }
      }
    ).listen(port);
    //
  };
  
/*Example */
let links = NavLinks(homepages)
const home = HTML(
    `<title>#JavaScriptFrist Bootstrap Site</title>`,
    `${ Nav(links)}`
);
Server('/',7000,home)